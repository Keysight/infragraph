components:
  schemas:
    Infrastructure:
      type: object
      properties:
        name:
          description: |-
            The name of the infrastructure being described.
          x-include: ./common.yaml#/components/schemas/Named.Object/properties/name
          example: Two Tier Clos Fabric
          x-field-uid: 1
        description:
          description: |-
            A description of the infrastructure being described.
          type: string
          example: |-
            The example fields in this schema are based on the Two Tier Clos Fabric Case Study outlined
            in the documentation `Getting Started` subsection.
          x-field-uid: 2
        devices:
          description: |-
            An array of the devices and their components present in the infrastructure connections.
          type: array
          items:
            $ref: './device.yaml#/components/schemas/Device'
          example:
            - name: generic-server
              instances:
                - count: 4
            - name: generic-switch
              instances:
                - name: leaf
                  count: 4
                - name: spine
                  count: 3
          x-field-uid: 3
        links:
          description: |-
            An inventory of the links that are part of the infrastructure connections property.
          type: array
          items:
            $ref: "./link.yaml#/components/schemas/Link"
          example:
            - name: eth
          x-field-uid: 4
        connections:
          description: |-
            Connections define the graph with each connection consisting of the following criteria in a string separated by dots:
            - `Device.Instance.property.name` e.g., host
            - a 0 based index that is less than `Device.Instance.property.count` e.g., 0
            - `Component.property.name` where `Component.property.external` is true e.g., nic
            - a 0 based index that is less than `Component.property.count` e.g., 0
            - `Infrastructure.properties.links.property.name`
            - `Device.Instance.property.name` e.g., leafsw
            - a 0 based index that is less than `Device.Instance.property.count` e.g., 0
            - `Component.property.name` where `Component.property.external` is true e.g., port
            - a 0 based index that is less than `Component.property.count` e.g., 0

            The example pieces are concatenated using a dot notation and would form the following connection string `host.0.nic.0.eth.leafsw.0.port.0`.
          type: array
          items:
            type: string
          example:
            - server.0.nic.0.eth.leaf.0.port.0
            - server.0.nic.1.eth.leaf.0.port.1
          x-field-uid: 5
        annotations:
          description: |-
            Annotations are meant to be used to correlate static and/or dynamic information
            (e.g., configuration, routing etc) that is not covered by the schema to logical endpoints.
          type: array
          items:
            $ref: "./annotation.yaml#/components/schemas/Annotation"
          x-field-uid: 6
          example:
            - name: logical_containers
              description: |-
                Improve clarity of infrastructure connections by grouping devices and
                other logical containers.
              data:
                containers:
                  - name: pod.0
                    items:
                      - server.0
                      - server.1
                      - leaf.0
                      - leaf.1
                  - name: pod.1
                    items:
                      - server.2
                      - server.3
                      - leaf.2
                      - leaf.3
                  - name: datacenter.0
                    items:
                      - pod.0
                      - pod.1
                      - spine.0
                      - spine.1
                      - spine.2
            - name: device_addresses
              data:
                server_addresses:
                  - device_instance: server.0
                    dns: host1.location.net
                  - device_instance: server.1
                    dns: host2.location.net
                  - device_instance: server.2
                    dns: host3.location.net
                  - device_instance: server.3
                    dns: host4.location.net


